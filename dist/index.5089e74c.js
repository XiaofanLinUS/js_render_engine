function t(t,a,r,e){Object.defineProperty(t,a,{get:r,set:e,enumerable:!0,configurable:!0})}var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r={},e={},n=a.parcelRequire94c2;null==n&&((n=function(t){if(t in r)return r[t].exports;if(t in e){var a=e[t];delete e[t];var n={id:t,exports:{}};return r[t]=n,a.call(n.exports,n,n.exports),n.exports}var d=new Error("Cannot find module '"+t+"'");throw d.code="MODULE_NOT_FOUND",d}).register=function(t,a){e[t]=a},a.parcelRequire94c2=n),n.register("27Lyk",(function(a,r){var e,n;t(a.exports,"register",(()=>e),(t=>e=t)),t(a.exports,"resolve",(()=>n),(t=>n=t));var d={};e=function(t){for(var a=Object.keys(t),r=0;r<a.length;r++)d[a[r]]=t[a[r]]},n=function(t){var a=d[t];if(null==a)throw new Error("Could not resolve bundle with id "+t);return a}})),n.register("lnzgw",(function(t,a){var r=n("e5hDi");t.exports={head:r}})),n.register("e5hDi",(function(t,a){t.exports=new URL(n("27Lyk").resolve("5pGYA"),import.meta.url).toString()})),n.register("cZkkG",(function(t,a){var r=n("7mcAn"),e=n("eM7aD"),d=n("3Zs75");t.exports={head:r,head_nm:e,head_nm_tangent:d}})),n.register("7mcAn",(function(t,a){t.exports=new URL(n("27Lyk").resolve("vf9yP"),import.meta.url).toString()})),n.register("eM7aD",(function(t,a){t.exports=new URL(n("27Lyk").resolve("9TEcs"),import.meta.url).toString()})),n.register("3Zs75",(function(t,a){t.exports=new URL(n("27Lyk").resolve("aNbEp"),import.meta.url).toString()})),n("27Lyk").register(JSON.parse('{"js9nD":"index.5089e74c.js","5pGYA":"head.5c6a572c.obj","vf9yP":"head.3730b696.png","9TEcs":"head_nm.221f1cfb.png","aNbEp":"head_nm_tangent.55857a88.png"}'));class d{data;constructor(t,a){this.data=[t,a]}x(){return this.data[0]}y(){return this.data[1]}sub(t){let a=this.data.map(((a,r)=>a-t.data[r]));return new d(a[0],a[1])}add(t){let a=this.data.map(((a,r)=>a+t.data[r]));return new d(a[0],a[1])}div(t){let a=this.data.map((a=>a/t));return new d(a[0],a[1])}mul(t){let a=this.data.map((a=>a*t));return new d(a[0],a[1])}static from_vec3(t){return new d(t.x(),t.y())}}class o{data;constructor(t,a,r){this.data=[t,a,r]}x(){return this.data[0]}y(){return this.data[1]}z(){return this.data[2]}div(t){let a=this.data.map((a=>a/t));return new o(a[0],a[1],a[2])}cross(t){let a=new Array(3);return a[0]=this.data[1]*t.data[2]-this.data[2]*t.data[1],a[1]=this.data[2]*t.data[0]-this.data[0]*t.data[2],a[2]=this.data[0]*t.data[1]-this.data[1]*t.data[0],new o(a[0],a[1],a[2])}sub(t){let a=this.data.map(((a,r)=>a-t.data[r]));return o.from_num_arr(a)}dot(t){return this.data.map(((a,r)=>a*t.data[r])).reduce(((t,a)=>t+a))}norm(){let t=this.dot(this);return Math.sqrt(t)}normalize(){let t=this.norm();this.data=this.div(t).data}static from_vertex=t=>new o(t.data.data[0],t.data.data[1],t.data.data[2]);static from_num_arr=t=>new o(t[0],t[1],t[2])}class i{data;constructor(t,a,r,e){this.data=[t,a,r,e]}x(){return this.data[0]}y(){return this.data[1]}z(){return this.data[2]}w(){return this.data[3]}div(t){let a=this.data.map((a=>a/t));return new i(a[0],a[1],a[2],a[3])}sub(t){let a=this.data.map(((a,r)=>a-t.data[r]));return i.from_num_arr(a)}dot(t){return this.data.map(((a,r)=>a*t.data[r])).reduce(((t,a)=>t+a))}norm(){let t=this.dot(this);return Math.sqrt(t)}normalize(){let t=this.norm();this.data=this.div(t).data}to_p(){let t=[...this.data];if(0==t[3])throw new Error("w coord is 0");return t[0]=t[0]/t[3],t[1]=t[1]/t[3],t[2]=t[2]/t[3],t[3]=1,i.from_num_arr(t)}static from_num_arr=t=>new i(t[0],t[1],t[2],t[3])}class s{data;constructor(){this.data=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]}static from_num_mat(t){let a=new s;return a.data=t,a}mul(t){let a=this.data,r=t.data,e=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];for(let t=0;t<=3;t++)for(let n=0;n<=3;n++){let d=0;for(let e=0;e<=3;e++)d+=a[t][e]*r[e][n];e[t][n]=d}return s.from_num_mat(e)}mul_v3(t){let a=this.data,r=t.data,e=new i(0,0,0,0);r=r.concat(0);for(let t=0;t<=3;t++)for(let n=0;n<=3;n++)e.data[t]+=a[t][n]*r[n];return o.from_num_arr(e.data)}mul_v4(t){let a=this.data,r=t.data,e=new i(0,0,0,0);for(let t=0;t<=3;t++)for(let n=0;n<=3;n++)e.data[t]+=a[t][n]*r[n];return e}static t(t){let a=new s;for(let r=0;r<=3;r++)for(let e=0;e<=3;e++)a.data[r][e]=t.data[e][r];return a}static inv(t){let a=t.data[2][2]*t.data[3][3]-t.data[2][3]*t.data[3][2],r=t.data[2][1]*t.data[3][3]-t.data[2][3]*t.data[3][1],e=t.data[2][1]*t.data[3][2]-t.data[2][2]*t.data[3][1],n=t.data[2][0]*t.data[3][3]-t.data[2][3]*t.data[3][0],d=t.data[2][0]*t.data[3][2]-t.data[2][2]*t.data[3][0],o=t.data[2][0]*t.data[3][1]-t.data[2][1]*t.data[3][0],i=t.data[1][2]*t.data[3][3]-t.data[1][3]*t.data[3][2],h=t.data[1][1]*t.data[3][3]-t.data[1][3]*t.data[3][1],l=t.data[1][1]*t.data[3][2]-t.data[1][2]*t.data[3][1],u=t.data[1][2]*t.data[2][3]-t.data[1][3]*t.data[2][2],c=t.data[1][1]*t.data[2][3]-t.data[1][3]*t.data[2][1],f=t.data[1][1]*t.data[2][2]-t.data[1][2]*t.data[2][1],m=t.data[1][0]*t.data[3][3]-t.data[1][3]*t.data[3][0],_=t.data[1][0]*t.data[3][2]-t.data[1][2]*t.data[3][0],M=t.data[1][0]*t.data[2][3]-t.data[1][3]*t.data[2][0],w=t.data[1][0]*t.data[2][2]-t.data[1][2]*t.data[2][0],v=t.data[1][0]*t.data[3][1]-t.data[1][1]*t.data[3][0],b=t.data[1][0]*t.data[2][1]-t.data[1][1]*t.data[2][0],x=t.data[0][0]*(t.data[1][1]*a-t.data[1][2]*r+t.data[1][3]*e)-t.data[0][1]*(t.data[1][0]*a-t.data[1][2]*n+t.data[1][3]*d)+t.data[0][2]*(t.data[1][0]*r-t.data[1][1]*n+t.data[1][3]*o)-t.data[0][3]*(t.data[1][0]*e-t.data[1][1]*d+t.data[1][2]*o);x=1/x;let g=new s;return g.data[0][0]=x*(t.data[1][1]*a-t.data[1][2]*r+t.data[1][3]*e),g.data[0][1]=x*-(t.data[0][1]*a-t.data[0][2]*r+t.data[0][3]*e),g.data[0][2]=x*(t.data[0][1]*i-t.data[0][2]*h+t.data[0][3]*l),g.data[0][3]=x*-(t.data[0][1]*u-t.data[0][2]*c+t.data[0][3]*f),g.data[1][0]=x*-(t.data[1][0]*a-t.data[1][2]*n+t.data[1][3]*d),g.data[1][1]=x*(t.data[0][0]*a-t.data[0][2]*n+t.data[0][3]*d),g.data[1][2]=x*-(t.data[0][0]*i-t.data[0][2]*m+t.data[0][3]*_),g.data[1][3]=x*(t.data[0][0]*u-t.data[0][2]*M+t.data[0][3]*w),g.data[2][0]=x*(t.data[1][0]*r-t.data[1][1]*n+t.data[1][3]*o),g.data[2][1]=x*-(t.data[0][0]*r-t.data[0][1]*n+t.data[0][3]*o),g.data[2][2]=x*(t.data[0][0]*h-t.data[0][1]*m+t.data[0][3]*v),g.data[2][3]=x*-(t.data[0][0]*c-t.data[0][1]*M+t.data[0][3]*b),g.data[3][0]=x*-(t.data[1][0]*e-t.data[1][1]*d+t.data[1][2]*o),g.data[3][1]=x*(t.data[0][0]*e-t.data[0][1]*d+t.data[0][2]*o),g.data[3][2]=x*-(t.data[0][0]*l-t.data[0][1]*_+t.data[0][2]*v),g.data[3][3]=x*(t.data[0][0]*f-t.data[0][1]*w+t.data[0][2]*b),g}static viewport(t,a,r,e){let n=new s;return n.data[0][3]=t+r/2,n.data[1][3]=a+e/2,n.data[2][3]=127.5,n.data[0][0]=r/2,n.data[1][1]=e/2,n.data[2][2]=127.5,n}static lookat(t,a,r){let e,n,d,o=t.sub(a);o.normalize(),d=o,e=r.cross(d),e.normalize(),n=d.cross(e);let i=new s,h=new s;for(let a=0;a<=2;a++)i.data[0][a]=e.data[a],i.data[1][a]=n.data[a],i.data[2][a]=d.data[a],h.data[a][3]=-t.data[a];return i.mul(h)}}class h{v_idx_arr;n_idx_arr;t_idx_arr;v_arr;n_arr;t_coord_arr;constructor(t,a,r,e,n,d,o,i,s,h,l,u){this.v_idx_arr=new Array,this.v_idx_arr.push(t),this.v_idx_arr.push(a),this.v_idx_arr.push(r),this.v_arr=e,null!=n&&(this.t_coord_arr=n,this.t_idx_arr=new Array,this.t_idx_arr.push(d),this.t_idx_arr.push(o),this.t_idx_arr.push(i)),null!=s&&(this.n_arr=s,this.n_idx_arr=new Array,this.n_idx_arr.push(h),this.n_idx_arr.push(l),this.n_idx_arr.push(u))}get_vertex(t){return this.v_arr[this.v_idx_arr[t]]}get_t_coord(t){if(t<0||t>=this.t_coord_arr.length)throw new Error("Invalid Index");if(0==this.t_coord_arr.length)throw new Error("No Texture coordinate to be retrived");return this.t_coord_arr[this.t_idx_arr[t]]}get_normal(t){if(t<0||t>=this.n_arr.length)throw new Error("Invalid Index");if(0==this.n_arr.length)throw new Error("No Normal to be retrived");return this.n_arr[this.n_idx_arr[t]]}}class l{data;constructor(t,a,r){this.data=new o(t,a,r)}}var u=async t=>{let a=n("lnzgw");try{let r=(await fetch(a[t],{credentials:"include",method:"get"}).then((t=>t.text()))).split("\n"),e=new Array,n=new Array,i=new Array,s=new Array;for(let t in r){let a=r[t].split(" ");if("v"==a[0]){let t=new l(Number(a[1]),Number(a[2]),Number(a[3]));n.push(t)}if("vt"==a[0]&&(a=a.filter((t=>t.length>0)),i.push(new d(Number(a[1]),Number(a[2])))),"vn"==a[0]&&(a=a.filter((t=>t.length>0)),s.push(new o(Number(a[1]),Number(a[2]),Number(a[3])))),"f"==a[0]){let t,r=Number(a[1].split("/")[0])-1,d=Number(a[2].split("/")[0])-1,o=Number(a[3].split("/")[0])-1,l=Number(a[1].split("/")[1])-1,u=Number(a[2].split("/")[1])-1,c=Number(a[3].split("/")[1])-1,f=Number(a[1].split("/")[2])-1,m=Number(a[2].split("/")[2])-1,_=Number(a[3].split("/")[2])-1;t=0!=i.length&&0!=s.length?new h(r,d,o,n,i,l,u,c,s,f,m,_):0!=i.length?new h(r,d,o,n,i,l,u,c):new h(r,d,o,n,null,null,null,null,s,f,m,_),e.push(t)}}return{faces:e}}catch(t){throw console.log("-----File reading error-----"+t),t}return null};let c=t=>{let a,r=n("cZkkG");return a=new Promise(((a,e)=>{let n=new Image;n.src=r[t],n.onload=()=>a(n),n.onerror=t=>{console.log(t),e(new Error("Image loading error."))}})).then((t=>{let a=t,r=a.width,e=a.height,n=document.createElement("canvas");n.height=e,n.width=r;let d=n.getContext("2d");return d.drawImage(a,0,0),{w:r,h:e,data:d.getImageData(0,0,r,e).data}})),a};let f=(t,a,r,e,n)=>{let o=[t,a,r].reduce(((t,a)=>t.data[0]<a.data[0]?t:a)).data[0],i=[t,a,r].reduce(((t,a)=>t.data[1]<a.data[1]?t:a)).data[1],s=[t,a,r].reduce(((t,a)=>t.data[0]>a.data[0]?t:a)).data[0],h=[t,a,r].reduce(((t,a)=>t.data[1]>a.data[1]?t:a)).data[1];return o=o<0?0:o,i=i<0?0:i,s=s>=e?e:s,h=h>=n?n:h,{min:new d(o,i),max:new d(s,h)}},m=(t,a,r,e)=>{let n=r.sub(a),d=e.sub(a),i=a.sub(t),s=new o(n.x(),d.x(),i.x()),h=new o(n.y(),d.y(),i.y()),l=s.cross(h);return Math.abs(l.z())<.01?new o(-1,1,1):new o(1-(l.x()+l.y())/l.z(),l.x()/l.z(),l.y()/l.z())},_=(t,a,r,e)=>{let n=((t,a,r,e)=>{let n=r.sub(a),d=e.sub(a),i=a.sub(t),s=new o(n.x(),d.x(),i.x()),h=new o(n.y(),d.y(),i.y()),l=s.cross(h);if(Math.abs(l.z())<1)return new o(-1,1,1);let u=l.div(l.z());return u=new o(1-(u.x()+u.y()),u.x(),u.y()),u})(t,a,r,e);return!n.data.some((t=>t<-.05))};class M{v;n;t;idx;constructor(){this.v=null,this.n=null,this.t=null,this.idx=null}}var w={};t(w,"create",(()=>b)),t(w,"clone",(()=>x)),t(w,"copy",(()=>g)),t(w,"fromValues",(()=>p)),t(w,"set",(()=>y)),t(w,"identity",(()=>z)),t(w,"transpose",(()=>A)),t(w,"invert",(()=>N)),t(w,"adjoint",(()=>I)),t(w,"determinant",(()=>R)),t(w,"multiply",(()=>E)),t(w,"translate",(()=>S)),t(w,"scale",(()=>T)),t(w,"rotate",(()=>D)),t(w,"rotateX",(()=>k)),t(w,"rotateY",(()=>q)),t(w,"rotateZ",(()=>F)),t(w,"fromTranslation",(()=>O)),t(w,"fromScaling",(()=>H)),t(w,"fromRotation",(()=>L)),t(w,"fromXRotation",(()=>P)),t(w,"fromYRotation",(()=>Z)),t(w,"fromZRotation",(()=>j)),t(w,"fromRotationTranslation",(()=>U)),t(w,"fromQuat2",(()=>C)),t(w,"getTranslation",(()=>G)),t(w,"getScaling",(()=>Y)),t(w,"getRotation",(()=>$)),t(w,"fromRotationTranslationScale",(()=>V)),t(w,"fromRotationTranslationScaleOrigin",(()=>Q)),t(w,"fromQuat",(()=>X)),t(w,"frustum",(()=>J)),t(w,"perspectiveNO",(()=>B)),t(w,"perspective",(()=>K)),t(w,"perspectiveZO",(()=>W)),t(w,"perspectiveFromFieldOfView",(()=>tt)),t(w,"orthoNO",(()=>at)),t(w,"ortho",(()=>rt)),t(w,"orthoZO",(()=>et)),t(w,"lookAt",(()=>nt)),t(w,"targetTo",(()=>dt)),t(w,"str",(()=>ot)),t(w,"frob",(()=>it)),t(w,"add",(()=>st)),t(w,"subtract",(()=>ht)),t(w,"multiplyScalar",(()=>lt)),t(w,"multiplyScalarAndAdd",(()=>ut)),t(w,"exactEquals",(()=>ct)),t(w,"equals",(()=>ft)),t(w,"mul",(()=>mt)),t(w,"sub",(()=>_t));var v="undefined"!=typeof Float32Array?Float32Array:Array;Math.random;Math.PI;function b(){var t=new v(16);return v!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function x(t){var a=new v(16);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a}function g(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t}function p(t,a,r,e,n,d,o,i,s,h,l,u,c,f,m,_){var M=new v(16);return M[0]=t,M[1]=a,M[2]=r,M[3]=e,M[4]=n,M[5]=d,M[6]=o,M[7]=i,M[8]=s,M[9]=h,M[10]=l,M[11]=u,M[12]=c,M[13]=f,M[14]=m,M[15]=_,M}function y(t,a,r,e,n,d,o,i,s,h,l,u,c,f,m,_,M){return t[0]=a,t[1]=r,t[2]=e,t[3]=n,t[4]=d,t[5]=o,t[6]=i,t[7]=s,t[8]=h,t[9]=l,t[10]=u,t[11]=c,t[12]=f,t[13]=m,t[14]=_,t[15]=M,t}function z(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function A(t,a){if(t===a){var r=a[1],e=a[2],n=a[3],d=a[6],o=a[7],i=a[11];t[1]=a[4],t[2]=a[8],t[3]=a[12],t[4]=r,t[6]=a[9],t[7]=a[13],t[8]=e,t[9]=d,t[11]=a[14],t[12]=n,t[13]=o,t[14]=i}else t[0]=a[0],t[1]=a[4],t[2]=a[8],t[3]=a[12],t[4]=a[1],t[5]=a[5],t[6]=a[9],t[7]=a[13],t[8]=a[2],t[9]=a[6],t[10]=a[10],t[11]=a[14],t[12]=a[3],t[13]=a[7],t[14]=a[11],t[15]=a[15];return t}function N(t,a){var r=a[0],e=a[1],n=a[2],d=a[3],o=a[4],i=a[5],s=a[6],h=a[7],l=a[8],u=a[9],c=a[10],f=a[11],m=a[12],_=a[13],M=a[14],w=a[15],v=r*i-e*o,b=r*s-n*o,x=r*h-d*o,g=e*s-n*i,p=e*h-d*i,y=n*h-d*s,z=l*_-u*m,A=l*M-c*m,N=l*w-f*m,I=u*M-c*_,R=u*w-f*_,E=c*w-f*M,S=v*E-b*R+x*I+g*N-p*A+y*z;return S?(S=1/S,t[0]=(i*E-s*R+h*I)*S,t[1]=(n*R-e*E-d*I)*S,t[2]=(_*y-M*p+w*g)*S,t[3]=(c*p-u*y-f*g)*S,t[4]=(s*N-o*E-h*A)*S,t[5]=(r*E-n*N+d*A)*S,t[6]=(M*x-m*y-w*b)*S,t[7]=(l*y-c*x+f*b)*S,t[8]=(o*R-i*N+h*z)*S,t[9]=(e*N-r*R-d*z)*S,t[10]=(m*p-_*x+w*v)*S,t[11]=(u*x-l*p-f*v)*S,t[12]=(i*A-o*I-s*z)*S,t[13]=(r*I-e*A+n*z)*S,t[14]=(_*b-m*g-M*v)*S,t[15]=(l*g-u*b+c*v)*S,t):null}function I(t,a){var r=a[0],e=a[1],n=a[2],d=a[3],o=a[4],i=a[5],s=a[6],h=a[7],l=a[8],u=a[9],c=a[10],f=a[11],m=a[12],_=a[13],M=a[14],w=a[15];return t[0]=i*(c*w-f*M)-u*(s*w-h*M)+_*(s*f-h*c),t[1]=-(e*(c*w-f*M)-u*(n*w-d*M)+_*(n*f-d*c)),t[2]=e*(s*w-h*M)-i*(n*w-d*M)+_*(n*h-d*s),t[3]=-(e*(s*f-h*c)-i*(n*f-d*c)+u*(n*h-d*s)),t[4]=-(o*(c*w-f*M)-l*(s*w-h*M)+m*(s*f-h*c)),t[5]=r*(c*w-f*M)-l*(n*w-d*M)+m*(n*f-d*c),t[6]=-(r*(s*w-h*M)-o*(n*w-d*M)+m*(n*h-d*s)),t[7]=r*(s*f-h*c)-o*(n*f-d*c)+l*(n*h-d*s),t[8]=o*(u*w-f*_)-l*(i*w-h*_)+m*(i*f-h*u),t[9]=-(r*(u*w-f*_)-l*(e*w-d*_)+m*(e*f-d*u)),t[10]=r*(i*w-h*_)-o*(e*w-d*_)+m*(e*h-d*i),t[11]=-(r*(i*f-h*u)-o*(e*f-d*u)+l*(e*h-d*i)),t[12]=-(o*(u*M-c*_)-l*(i*M-s*_)+m*(i*c-s*u)),t[13]=r*(u*M-c*_)-l*(e*M-n*_)+m*(e*c-n*u),t[14]=-(r*(i*M-s*_)-o*(e*M-n*_)+m*(e*s-n*i)),t[15]=r*(i*c-s*u)-o*(e*c-n*u)+l*(e*s-n*i),t}function R(t){var a=t[0],r=t[1],e=t[2],n=t[3],d=t[4],o=t[5],i=t[6],s=t[7],h=t[8],l=t[9],u=t[10],c=t[11],f=t[12],m=t[13],_=t[14],M=t[15];return(a*o-r*d)*(u*M-c*_)-(a*i-e*d)*(l*M-c*m)+(a*s-n*d)*(l*_-u*m)+(r*i-e*o)*(h*M-c*f)-(r*s-n*o)*(h*_-u*f)+(e*s-n*i)*(h*m-l*f)}function E(t,a,r){var e=a[0],n=a[1],d=a[2],o=a[3],i=a[4],s=a[5],h=a[6],l=a[7],u=a[8],c=a[9],f=a[10],m=a[11],_=a[12],M=a[13],w=a[14],v=a[15],b=r[0],x=r[1],g=r[2],p=r[3];return t[0]=b*e+x*i+g*u+p*_,t[1]=b*n+x*s+g*c+p*M,t[2]=b*d+x*h+g*f+p*w,t[3]=b*o+x*l+g*m+p*v,b=r[4],x=r[5],g=r[6],p=r[7],t[4]=b*e+x*i+g*u+p*_,t[5]=b*n+x*s+g*c+p*M,t[6]=b*d+x*h+g*f+p*w,t[7]=b*o+x*l+g*m+p*v,b=r[8],x=r[9],g=r[10],p=r[11],t[8]=b*e+x*i+g*u+p*_,t[9]=b*n+x*s+g*c+p*M,t[10]=b*d+x*h+g*f+p*w,t[11]=b*o+x*l+g*m+p*v,b=r[12],x=r[13],g=r[14],p=r[15],t[12]=b*e+x*i+g*u+p*_,t[13]=b*n+x*s+g*c+p*M,t[14]=b*d+x*h+g*f+p*w,t[15]=b*o+x*l+g*m+p*v,t}function S(t,a,r){var e,n,d,o,i,s,h,l,u,c,f,m,_=r[0],M=r[1],w=r[2];return a===t?(t[12]=a[0]*_+a[4]*M+a[8]*w+a[12],t[13]=a[1]*_+a[5]*M+a[9]*w+a[13],t[14]=a[2]*_+a[6]*M+a[10]*w+a[14],t[15]=a[3]*_+a[7]*M+a[11]*w+a[15]):(e=a[0],n=a[1],d=a[2],o=a[3],i=a[4],s=a[5],h=a[6],l=a[7],u=a[8],c=a[9],f=a[10],m=a[11],t[0]=e,t[1]=n,t[2]=d,t[3]=o,t[4]=i,t[5]=s,t[6]=h,t[7]=l,t[8]=u,t[9]=c,t[10]=f,t[11]=m,t[12]=e*_+i*M+u*w+a[12],t[13]=n*_+s*M+c*w+a[13],t[14]=d*_+h*M+f*w+a[14],t[15]=o*_+l*M+m*w+a[15]),t}function T(t,a,r){var e=r[0],n=r[1],d=r[2];return t[0]=a[0]*e,t[1]=a[1]*e,t[2]=a[2]*e,t[3]=a[3]*e,t[4]=a[4]*n,t[5]=a[5]*n,t[6]=a[6]*n,t[7]=a[7]*n,t[8]=a[8]*d,t[9]=a[9]*d,t[10]=a[10]*d,t[11]=a[11]*d,t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t}function D(t,a,r,e){var n,d,o,i,s,h,l,u,c,f,m,_,M,w,v,b,x,g,p,y,z,A,N,I,R=e[0],E=e[1],S=e[2],T=Math.hypot(R,E,S);return T<1e-6?null:(R*=T=1/T,E*=T,S*=T,n=Math.sin(r),o=1-(d=Math.cos(r)),i=a[0],s=a[1],h=a[2],l=a[3],u=a[4],c=a[5],f=a[6],m=a[7],_=a[8],M=a[9],w=a[10],v=a[11],b=R*R*o+d,x=E*R*o+S*n,g=S*R*o-E*n,p=R*E*o-S*n,y=E*E*o+d,z=S*E*o+R*n,A=R*S*o+E*n,N=E*S*o-R*n,I=S*S*o+d,t[0]=i*b+u*x+_*g,t[1]=s*b+c*x+M*g,t[2]=h*b+f*x+w*g,t[3]=l*b+m*x+v*g,t[4]=i*p+u*y+_*z,t[5]=s*p+c*y+M*z,t[6]=h*p+f*y+w*z,t[7]=l*p+m*y+v*z,t[8]=i*A+u*N+_*I,t[9]=s*A+c*N+M*I,t[10]=h*A+f*N+w*I,t[11]=l*A+m*N+v*I,a!==t&&(t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t)}function k(t,a,r){var e=Math.sin(r),n=Math.cos(r),d=a[4],o=a[5],i=a[6],s=a[7],h=a[8],l=a[9],u=a[10],c=a[11];return a!==t&&(t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[4]=d*n+h*e,t[5]=o*n+l*e,t[6]=i*n+u*e,t[7]=s*n+c*e,t[8]=h*n-d*e,t[9]=l*n-o*e,t[10]=u*n-i*e,t[11]=c*n-s*e,t}function q(t,a,r){var e=Math.sin(r),n=Math.cos(r),d=a[0],o=a[1],i=a[2],s=a[3],h=a[8],l=a[9],u=a[10],c=a[11];return a!==t&&(t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=d*n-h*e,t[1]=o*n-l*e,t[2]=i*n-u*e,t[3]=s*n-c*e,t[8]=d*e+h*n,t[9]=o*e+l*n,t[10]=i*e+u*n,t[11]=s*e+c*n,t}function F(t,a,r){var e=Math.sin(r),n=Math.cos(r),d=a[0],o=a[1],i=a[2],s=a[3],h=a[4],l=a[5],u=a[6],c=a[7];return a!==t&&(t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=d*n+h*e,t[1]=o*n+l*e,t[2]=i*n+u*e,t[3]=s*n+c*e,t[4]=h*n-d*e,t[5]=l*n-o*e,t[6]=u*n-i*e,t[7]=c*n-s*e,t}function O(t,a){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=a[0],t[13]=a[1],t[14]=a[2],t[15]=1,t}function H(t,a){return t[0]=a[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=a[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function L(t,a,r){var e,n,d,o=r[0],i=r[1],s=r[2],h=Math.hypot(o,i,s);return h<1e-6?null:(o*=h=1/h,i*=h,s*=h,e=Math.sin(a),d=1-(n=Math.cos(a)),t[0]=o*o*d+n,t[1]=i*o*d+s*e,t[2]=s*o*d-i*e,t[3]=0,t[4]=o*i*d-s*e,t[5]=i*i*d+n,t[6]=s*i*d+o*e,t[7]=0,t[8]=o*s*d+i*e,t[9]=i*s*d-o*e,t[10]=s*s*d+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function P(t,a){var r=Math.sin(a),e=Math.cos(a);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Z(t,a){var r=Math.sin(a),e=Math.cos(a);return t[0]=e,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function j(t,a){var r=Math.sin(a),e=Math.cos(a);return t[0]=e,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function U(t,a,r){var e=a[0],n=a[1],d=a[2],o=a[3],i=e+e,s=n+n,h=d+d,l=e*i,u=e*s,c=e*h,f=n*s,m=n*h,_=d*h,M=o*i,w=o*s,v=o*h;return t[0]=1-(f+_),t[1]=u+v,t[2]=c-w,t[3]=0,t[4]=u-v,t[5]=1-(l+_),t[6]=m+M,t[7]=0,t[8]=c+w,t[9]=m-M,t[10]=1-(l+f),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function C(t,a){var r=new v(3),e=-a[0],n=-a[1],d=-a[2],o=a[3],i=a[4],s=a[5],h=a[6],l=a[7],u=e*e+n*n+d*d+o*o;return u>0?(r[0]=2*(i*o+l*e+s*d-h*n)/u,r[1]=2*(s*o+l*n+h*e-i*d)/u,r[2]=2*(h*o+l*d+i*n-s*e)/u):(r[0]=2*(i*o+l*e+s*d-h*n),r[1]=2*(s*o+l*n+h*e-i*d),r[2]=2*(h*o+l*d+i*n-s*e)),U(t,a,r),t}function G(t,a){return t[0]=a[12],t[1]=a[13],t[2]=a[14],t}function Y(t,a){var r=a[0],e=a[1],n=a[2],d=a[4],o=a[5],i=a[6],s=a[8],h=a[9],l=a[10];return t[0]=Math.hypot(r,e,n),t[1]=Math.hypot(d,o,i),t[2]=Math.hypot(s,h,l),t}function $(t,a){var r=new v(3);Y(r,a);var e=1/r[0],n=1/r[1],d=1/r[2],o=a[0]*e,i=a[1]*n,s=a[2]*d,h=a[4]*e,l=a[5]*n,u=a[6]*d,c=a[8]*e,f=a[9]*n,m=a[10]*d,_=o+l+m,M=0;return _>0?(M=2*Math.sqrt(_+1),t[3]=.25*M,t[0]=(u-f)/M,t[1]=(c-s)/M,t[2]=(i-h)/M):o>l&&o>m?(M=2*Math.sqrt(1+o-l-m),t[3]=(u-f)/M,t[0]=.25*M,t[1]=(i+h)/M,t[2]=(c+s)/M):l>m?(M=2*Math.sqrt(1+l-o-m),t[3]=(c-s)/M,t[0]=(i+h)/M,t[1]=.25*M,t[2]=(u+f)/M):(M=2*Math.sqrt(1+m-o-l),t[3]=(i-h)/M,t[0]=(c+s)/M,t[1]=(u+f)/M,t[2]=.25*M),t}function V(t,a,r,e){var n=a[0],d=a[1],o=a[2],i=a[3],s=n+n,h=d+d,l=o+o,u=n*s,c=n*h,f=n*l,m=d*h,_=d*l,M=o*l,w=i*s,v=i*h,b=i*l,x=e[0],g=e[1],p=e[2];return t[0]=(1-(m+M))*x,t[1]=(c+b)*x,t[2]=(f-v)*x,t[3]=0,t[4]=(c-b)*g,t[5]=(1-(u+M))*g,t[6]=(_+w)*g,t[7]=0,t[8]=(f+v)*p,t[9]=(_-w)*p,t[10]=(1-(u+m))*p,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function Q(t,a,r,e,n){var d=a[0],o=a[1],i=a[2],s=a[3],h=d+d,l=o+o,u=i+i,c=d*h,f=d*l,m=d*u,_=o*l,M=o*u,w=i*u,v=s*h,b=s*l,x=s*u,g=e[0],p=e[1],y=e[2],z=n[0],A=n[1],N=n[2],I=(1-(_+w))*g,R=(f+x)*g,E=(m-b)*g,S=(f-x)*p,T=(1-(c+w))*p,D=(M+v)*p,k=(m+b)*y,q=(M-v)*y,F=(1-(c+_))*y;return t[0]=I,t[1]=R,t[2]=E,t[3]=0,t[4]=S,t[5]=T,t[6]=D,t[7]=0,t[8]=k,t[9]=q,t[10]=F,t[11]=0,t[12]=r[0]+z-(I*z+S*A+k*N),t[13]=r[1]+A-(R*z+T*A+q*N),t[14]=r[2]+N-(E*z+D*A+F*N),t[15]=1,t}function X(t,a){var r=a[0],e=a[1],n=a[2],d=a[3],o=r+r,i=e+e,s=n+n,h=r*o,l=e*o,u=e*i,c=n*o,f=n*i,m=n*s,_=d*o,M=d*i,w=d*s;return t[0]=1-u-m,t[1]=l+w,t[2]=c-M,t[3]=0,t[4]=l-w,t[5]=1-h-m,t[6]=f+_,t[7]=0,t[8]=c+M,t[9]=f-_,t[10]=1-h-u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function J(t,a,r,e,n,d,o){var i=1/(r-a),s=1/(n-e),h=1/(d-o);return t[0]=2*d*i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*d*s,t[6]=0,t[7]=0,t[8]=(r+a)*i,t[9]=(n+e)*s,t[10]=(o+d)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*d*2*h,t[15]=0,t}function B(t,a,r,e,n){var d,o=1/Math.tan(a/2);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(d=1/(e-n),t[10]=(n+e)*d,t[14]=2*n*e*d):(t[10]=-1,t[14]=-2*e),t}Math.hypot||(Math.hypot=function(){for(var t=0,a=arguments.length;a--;)t+=arguments[a]*arguments[a];return Math.sqrt(t)});var K=B;function W(t,a,r,e,n){var d,o=1/Math.tan(a/2);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(d=1/(e-n),t[10]=n*d,t[14]=n*e*d):(t[10]=-1,t[14]=-e),t}function tt(t,a,r,e){var n=Math.tan(a.upDegrees*Math.PI/180),d=Math.tan(a.downDegrees*Math.PI/180),o=Math.tan(a.leftDegrees*Math.PI/180),i=Math.tan(a.rightDegrees*Math.PI/180),s=2/(o+i),h=2/(n+d);return t[0]=s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=-(o-i)*s*.5,t[9]=(n-d)*h*.5,t[10]=e/(r-e),t[11]=-1,t[12]=0,t[13]=0,t[14]=e*r/(r-e),t[15]=0,t}function at(t,a,r,e,n,d,o){var i=1/(a-r),s=1/(e-n),h=1/(d-o);return t[0]=-2*i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(a+r)*i,t[13]=(n+e)*s,t[14]=(o+d)*h,t[15]=1,t}var rt=at;function et(t,a,r,e,n,d,o){var i=1/(a-r),s=1/(e-n),h=1/(d-o);return t[0]=-2*i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=h,t[11]=0,t[12]=(a+r)*i,t[13]=(n+e)*s,t[14]=d*h,t[15]=1,t}function nt(t,a,r,e){var n,d,o,i,s,h,l,u,c,f,m=a[0],_=a[1],M=a[2],w=e[0],v=e[1],b=e[2],x=r[0],g=r[1],p=r[2];return Math.abs(m-x)<1e-6&&Math.abs(_-g)<1e-6&&Math.abs(M-p)<1e-6?z(t):(l=m-x,u=_-g,c=M-p,n=v*(c*=f=1/Math.hypot(l,u,c))-b*(u*=f),d=b*(l*=f)-w*c,o=w*u-v*l,(f=Math.hypot(n,d,o))?(n*=f=1/f,d*=f,o*=f):(n=0,d=0,o=0),i=u*o-c*d,s=c*n-l*o,h=l*d-u*n,(f=Math.hypot(i,s,h))?(i*=f=1/f,s*=f,h*=f):(i=0,s=0,h=0),t[0]=n,t[1]=i,t[2]=l,t[3]=0,t[4]=d,t[5]=s,t[6]=u,t[7]=0,t[8]=o,t[9]=h,t[10]=c,t[11]=0,t[12]=-(n*m+d*_+o*M),t[13]=-(i*m+s*_+h*M),t[14]=-(l*m+u*_+c*M),t[15]=1,t)}function dt(t,a,r,e){var n=a[0],d=a[1],o=a[2],i=e[0],s=e[1],h=e[2],l=n-r[0],u=d-r[1],c=o-r[2],f=l*l+u*u+c*c;f>0&&(l*=f=1/Math.sqrt(f),u*=f,c*=f);var m=s*c-h*u,_=h*l-i*c,M=i*u-s*l;return(f=m*m+_*_+M*M)>0&&(m*=f=1/Math.sqrt(f),_*=f,M*=f),t[0]=m,t[1]=_,t[2]=M,t[3]=0,t[4]=u*M-c*_,t[5]=c*m-l*M,t[6]=l*_-u*m,t[7]=0,t[8]=l,t[9]=u,t[10]=c,t[11]=0,t[12]=n,t[13]=d,t[14]=o,t[15]=1,t}function ot(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function it(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function st(t,a,r){return t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t[3]=a[3]+r[3],t[4]=a[4]+r[4],t[5]=a[5]+r[5],t[6]=a[6]+r[6],t[7]=a[7]+r[7],t[8]=a[8]+r[8],t[9]=a[9]+r[9],t[10]=a[10]+r[10],t[11]=a[11]+r[11],t[12]=a[12]+r[12],t[13]=a[13]+r[13],t[14]=a[14]+r[14],t[15]=a[15]+r[15],t}function ht(t,a,r){return t[0]=a[0]-r[0],t[1]=a[1]-r[1],t[2]=a[2]-r[2],t[3]=a[3]-r[3],t[4]=a[4]-r[4],t[5]=a[5]-r[5],t[6]=a[6]-r[6],t[7]=a[7]-r[7],t[8]=a[8]-r[8],t[9]=a[9]-r[9],t[10]=a[10]-r[10],t[11]=a[11]-r[11],t[12]=a[12]-r[12],t[13]=a[13]-r[13],t[14]=a[14]-r[14],t[15]=a[15]-r[15],t}function lt(t,a,r){return t[0]=a[0]*r,t[1]=a[1]*r,t[2]=a[2]*r,t[3]=a[3]*r,t[4]=a[4]*r,t[5]=a[5]*r,t[6]=a[6]*r,t[7]=a[7]*r,t[8]=a[8]*r,t[9]=a[9]*r,t[10]=a[10]*r,t[11]=a[11]*r,t[12]=a[12]*r,t[13]=a[13]*r,t[14]=a[14]*r,t[15]=a[15]*r,t}function ut(t,a,r,e){return t[0]=a[0]+r[0]*e,t[1]=a[1]+r[1]*e,t[2]=a[2]+r[2]*e,t[3]=a[3]+r[3]*e,t[4]=a[4]+r[4]*e,t[5]=a[5]+r[5]*e,t[6]=a[6]+r[6]*e,t[7]=a[7]+r[7]*e,t[8]=a[8]+r[8]*e,t[9]=a[9]+r[9]*e,t[10]=a[10]+r[10]*e,t[11]=a[11]+r[11]*e,t[12]=a[12]+r[12]*e,t[13]=a[13]+r[13]*e,t[14]=a[14]+r[14]*e,t[15]=a[15]+r[15]*e,t}function ct(t,a){return t[0]===a[0]&&t[1]===a[1]&&t[2]===a[2]&&t[3]===a[3]&&t[4]===a[4]&&t[5]===a[5]&&t[6]===a[6]&&t[7]===a[7]&&t[8]===a[8]&&t[9]===a[9]&&t[10]===a[10]&&t[11]===a[11]&&t[12]===a[12]&&t[13]===a[13]&&t[14]===a[14]&&t[15]===a[15]}function ft(t,a){var r=t[0],e=t[1],n=t[2],d=t[3],o=t[4],i=t[5],s=t[6],h=t[7],l=t[8],u=t[9],c=t[10],f=t[11],m=t[12],_=t[13],M=t[14],w=t[15],v=a[0],b=a[1],x=a[2],g=a[3],p=a[4],y=a[5],z=a[6],A=a[7],N=a[8],I=a[9],R=a[10],E=a[11],S=a[12],T=a[13],D=a[14],k=a[15];return Math.abs(r-v)<=1e-6*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(e-b)<=1e-6*Math.max(1,Math.abs(e),Math.abs(b))&&Math.abs(n-x)<=1e-6*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(d-g)<=1e-6*Math.max(1,Math.abs(d),Math.abs(g))&&Math.abs(o-p)<=1e-6*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(i-y)<=1e-6*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(s-z)<=1e-6*Math.max(1,Math.abs(s),Math.abs(z))&&Math.abs(h-A)<=1e-6*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(l-N)<=1e-6*Math.max(1,Math.abs(l),Math.abs(N))&&Math.abs(u-I)<=1e-6*Math.max(1,Math.abs(u),Math.abs(I))&&Math.abs(c-R)<=1e-6*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(f-E)<=1e-6*Math.max(1,Math.abs(f),Math.abs(E))&&Math.abs(m-S)<=1e-6*Math.max(1,Math.abs(m),Math.abs(S))&&Math.abs(_-T)<=1e-6*Math.max(1,Math.abs(_),Math.abs(T))&&Math.abs(M-D)<=1e-6*Math.max(1,Math.abs(M),Math.abs(D))&&Math.abs(w-k)<=1e-6*Math.max(1,Math.abs(w),Math.abs(k))}var mt=E,_t=ht;let Mt=document.querySelector("#view");Mt.width=1200,Mt.height=1200;let wt,vt=new class{canvas;ctx;img_data;w;h;constructor(t){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.img_data=this.ctx.getImageData(0,0,t.width,t.height),this.w=t.width,this.h=t.height}clear(){this.ctx.fillStyle="rgba(0,0,0,255)",this.ctx.fillRect(0,0,this.w,this.h),this.img_data=this.ctx.getImageData(0,0,this.w,this.h)}paint(){this.ctx.putImageData(this.img_data,0,0)}draw_dot(t,a,r){if(t>=this.w||t<0||a>=this.h||a<0)return;t=Math.floor(t),a=Math.floor(a);let e=4*(t+(a=this.h-a-1)*this.w);this.img_data.data[e]=r.r,this.img_data.data[e+1]=r.g,this.img_data.data[e+2]=r.b,this.img_data.data[e+3]=r.a}fill_triangle2(t,a,r,e){let n=f(t,a,r,this.w,this.h);for(let o=n.min.data[0];o<=n.max.data[0];o++)for(let i=n.min.data[1];i<=n.max.data[1];i++){let n=new d(o,i);_(n,t,a,r)&&this.draw_dot(n.x(),n.y(),e)}}fill_triangle(t,a,r,e){if(t.data[1]==a.data[1]&&t.data[1]==r.data[1])return;let n=t.add(a.add(r)).div(3),d=[t=n.add(t.sub(n).mul(1.01)),a=n.add(a.sub(n).mul(1.01)),r=n.add(r.sub(n).mul(1.01))];d.sort(((t,a)=>t.data[1]<a.data[1]?-1:1));for(let t=d[0].data[1];t<=d[2].data[1];t++){let a,r,n=d[0].data[0],o=d[1].data[0],i=d[2].data[0],s=d[0].data[1],h=d[1].data[1],l=d[2].data[1],u=t-s;r=(i-n)/(l-s)*u+n,t<=h&&s!=h?a=(o-n)/(h-s)*u+n:(u=t-h,a=(i-o)/(l-h)*u+o),a>r&&([a,r]=[r,a]);for(let n=a;n<=r;n++)this.draw_dot(n,t,e),this.draw_dot(n,t,e)}}draw_line1(t,a,r,e,n){for(let d=0;d<=1;d+=.01){let o=t+(r-t)*d,i=a+(e-a)*d;this.ctx.fillStyle=n,this.ctx.fillRect(o,i,1,1)}}draw_line2(t,a,r,e,n){for(let d=t;d<=r;d++){let o=a+(e-a)*((d-t)/(r-t));this.draw_dot(d,o,n)}}draw_line3(t,a,r,e,n){let d=!1;Math.abs(r-t)<Math.abs(e-a)&&(d=!0,[t,a,r,e]=[a,t,e,r]),r<t&&([t,a,r,e]=[r,e,t,a]);for(let o=t;o<=r;o++){let i=(o-t)/(r-t),s=Math.floor(a+(e-a)*i);d?this.draw_dot(s,o,n):this.draw_dot(o,s,n)}}draw_line4(t,a,r,e,n){let d=!1;[t,a,r,e]=[t,a,r,e].map(Math.floor),Math.abs(r-t)<Math.abs(e-a)&&(d=!0,[t,a]=[a,t],[r,e]=[e,r]),r<t&&([t,r]=[r,t],[a,e]=[e,a]);let o=Math.abs((e-a)/(r-t)),i=0,s=a;for(let h=t;h<=r;h++)d?this.draw_dot(s,h,n):this.draw_dot(h,s,n),i+=o,i>1&&(s+=e>a?1:-1,i-=1)}fill_triangle_texture(t,a,r,e,n,i,s,h,l){let u=f(d.from_vec3(t),d.from_vec3(a),d.from_vec3(r),this.w,this.h),c=u.min,_=u.max;for(let d=Math.floor(c.x());d<=Math.floor(_.x());d++)for(let u=Math.floor(c.y());u<=Math.floor(_.y());u++){let c=new o(d,u,0),f=m(c,t,a,r);if(f.data.some((t=>t<0)))continue;let _=t.z()*f.x()+a.z()*f.y()+r.z()*f.z(),M=s.mul(f.x()).add(h.mul(f.y())).add(l.mul(f.z())),w=4*(Math.floor(M.x()*i.w)+(i.h-Math.floor(M.y()*i.h)-1)*i.w),v={r:255*e,g:255*e,b:255*e,a:i.data[w+3]},b=Math.floor(d)+Math.floor(u)*this.canvas.width;_>n[b]&&(n[b]=_,this.draw_dot(d,u,v))}}fill_triangle_texture_(t,a,r,e,n,i,s,h,l,u,c){let _=f(d.from_vec3(t),d.from_vec3(a),d.from_vec3(r),this.w,this.h),M=_.min,w=_.max;for(let d=Math.floor(M.x());d<=Math.floor(w.x());d++)for(let f=Math.floor(M.y());f<=Math.floor(w.y());f++){let _=new o(d,f,0),M=m(_,t,a,r);if(M.data.some((t=>t<0)))continue;let w=t.z()*M.x()+a.z()*M.y()+r.z()*M.z(),v=e*M.x()+n*M.y()+i*M.z(),b=l.mul(M.x()).add(u.mul(M.y())).add(c.mul(M.z())),x=4*(Math.floor(b.x()*h.w)+(h.h-Math.floor(b.y()*h.h)-1)*h.w);v=v<0?0:v;{let t={r:255*v,g:255*v,b:255*v,a:h.data[x+3]},a=Math.floor(d)+Math.floor(f)*this.w;w>s[a]&&(s[a]=w,this.draw_dot(d,f,t))}}}fill_triangle_shader([t,a,r],e,n){let i=f(d.from_vec3(t),d.from_vec3(a),d.from_vec3(r),this.w,this.h),s=i.min,h=i.max;for(let d=Math.floor(s.x());d<=Math.floor(h.x());d++)for(let i=Math.floor(s.y());i<=Math.floor(h.y());i++){let s=new o(d,i,0),h=m(s,t,a,r);if(h.data.some((t=>t<0)))continue;let l=t.z()*h.x()+a.z()*h.y()+r.z()*h.z(),u=e.fragment(h),c=Math.floor(d)+Math.floor(i)*this.w;l>n[c]&&(n[c]=l,this.draw_dot(d,i,u))}}draw_line4_v(t,a,r){this.draw_line4(t.data[0],t.data[1],a.data[0],a.data[1],r)}draw_triangle(t,a,r,e){this.draw_line4_v(t,a,e),this.draw_line4_v(a,r,e),this.draw_line4_v(r,t,e)}fill_triangle_vec3(t,a,r,e,n){let i=f(d.from_vec3(t),d.from_vec3(a),d.from_vec3(r),this.w,this.h),s=i.min,h=i.max;for(let d=Math.floor(s.x());d<=Math.floor(h.x());d++)for(let i=Math.floor(s.y());i<=Math.floor(h.y());i++){let s=new o(d,i,0),h=m(s,t,a,r),l=h.data.some((t=>t<0)),u=t.z()*h.x()+a.z()*h.y()+r.z()*h.z();if(l)continue;311==Math.floor(d)&&59==Math.floor(i)&&console.log("Hit");let c=Math.floor(d)+Math.floor(i)*this.w;u>n[c]&&(n[c]=u,this.draw_dot(d,i,e))}}}(Mt),bt=await u("head");wt=bt.faces;let xt=await c("head"),gt=await c("head_nm"),pt=new o(0,0,1),yt=new o(0,0,0),zt=new o(0,1,0),At=s.lookat(pt,yt,zt),Nt=new o(1,-1,1);Nt.normalize();let It=new s;It.data[3][2]=-.5;let Rt=s.viewport(0,0,Mt.width,Mt.height).mul(It.mul(At));function Et(t,a){let r=4*(Math.floor(a.x()*t.w)-1+(t.h-(Math.floor(a.y()*t.h)-1)-1)*t.w);return{r:t.data[r],g:t.data[r+1],b:t.data[r+2],a:255}}let St=new class extends class{}{intensity;t_coord;M;M_IT;constructor(){super(),this.intensity=new Array(3).fill(0),this.t_coord=new Array(3)}vertex({v:t,n:a,t:r,idx:e}){let n=i.from_num_arr(t.data.concat(1)),d=Nt.dot(a);return n=Rt.mul_v4(n).to_p(),this.intensity[e]=d,this.t_coord[e]=r,o.from_num_arr(n.data)}fragment(t){let a=this.t_coord[0].mul(t.x()).add(this.t_coord[1].mul(t.y())).add(this.t_coord[2].mul(t.z())),r=Et(xt,a),e=Et(gt,a),n=new o(e.r,e.g,e.b);n.div(127.5).sub(new o(1,1,1)),n=this.M_IT.mul_v3(n),Nt=this.M.mul_v3(Nt),n.normalize(),Nt.normalize();let d=Math.max(0,Nt.dot(n));return{r:d*r.r,g:d*r.g,b:0*d,a:255}}};St.M=It.mul(At);let Tt=It.mul(At),Dt=w.create(),kt=w.fromValues(Tt.data[0][0],Tt.data[1][0],Tt.data[2][0],Tt.data[3][0],Tt.data[0][1],Tt.data[1][1],Tt.data[2][1],Tt.data[3][1],Tt.data[0][2],Tt.data[1][2],Tt.data[2][2],Tt.data[3][2],Tt.data[0][3],Tt.data[1][3],Tt.data[2][3],Tt.data[3][3]);w.invert(Dt,kt),St.M_IT=s.t(s.inv(St.M)),console.log(`m_ ${Dt}`),console.log(`m ${St.M_IT.data}`);let qt=new i(1,1,5,1),Ft=new i(0,0,0,1),Ot=new i(1,2,1,0),Ht=qt.sub(Ft),Lt=St.M.mul_v4(qt),Pt=St.M.mul_v4(Ft),Zt=St.M_IT.mul_v4(Ot);console.log(St.M.mul(St.M_IT).data);let jt=St.M.mul_v4(Ht),Ut=Lt.sub(Pt);Ht.normalize(),Ot.normalize(),Ut.normalize(),jt.normalize(),Zt.normalize(),console.log(Ht.dot(Ot)),console.log(Ut.dot(Zt)),console.log(`ut__ ${jt.data}`),console.log(`ut_ ${Ut.data}`);let Ct=new Array(Mt.height*Mt.width).fill(-1/0);!function(){vt.clear();for(let t in wt){let a=wt[t],r=new Array;for(let t=0;t<=2;t++){let e=new M;e.v=a.get_vertex(t).data,e.n=a.get_normal(t),e.t=a.get_t_coord(t),e.idx=t,r.push(St.vertex(e))}vt.fill_triangle_shader(r,St,Ct)}vt.paint()}();
//# sourceMappingURL=index.5089e74c.js.map
